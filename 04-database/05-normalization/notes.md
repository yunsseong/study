# 정규화 (Normalization)

## 개념

- 데이터 **중복을 최소화**하고 **무결성을 보장**하기 위해 테이블을 분리하는 과정
- 이상 현상(Anomaly)을 방지

### 이상 현상 (Anomaly)

정규화가 안 된 테이블에서 발생하는 문제.

```
| 학생 | 과목   | 교수    | 교수 전화번호 |
|------|--------|---------|-------------|
| 김철수| 데이터베이스 | 이교수 | 010-1234     |
| 김철수| 알고리즘   | 박교수 | 010-5678     |
| 이영희| 데이터베이스 | 이교수 | 010-1234     |
```

| 이상 현상 | 문제 |
|----------|------|
| **삽입 이상** | 새 교수를 등록하려면 학생이 있어야 함 |
| **갱신 이상** | 이교수 전화번호 변경 시 여러 행을 수정해야 함 (하나 빼먹으면 불일치) |
| **삭제 이상** | 이영희를 삭제하면 이교수 정보도 사라짐 |

---

## 정규형 단계

### 제1정규형 (1NF)

**모든 컬럼의 값이 원자값(단일 값)**이어야 함.

```
❌ 1NF 위반:
| 학생 | 수강과목              |
|------|----------------------|
| 김철수| 데이터베이스, 알고리즘    |   ← 다중 값!

✅ 1NF 충족:
| 학생 | 수강과목     |
|------|------------|
| 김철수| 데이터베이스  |
| 김철수| 알고리즘     |
```

### 제2정규형 (2NF)

1NF + **부분 함수 종속 제거** (기본키의 일부에만 종속되는 컬럼 분리).

```
❌ 2NF 위반: 기본키 = (학생, 과목)
| 학생 | 과목      | 교수   | 학년 |
|------|----------|--------|------|
| 김철수| DB       | 이교수 | 3    |
| 김철수| 알고리즘  | 박교수 | 3    |

"학년"은 "학생"에만 종속 (과목과 무관) → 부분 종속

✅ 2NF 충족: 테이블 분리
수강 테이블:                     학생 테이블:
| 학생 | 과목     | 교수   |    | 학생 | 학년 |
|------|---------|--------|    |------|------|
| 김철수| DB      | 이교수 |    | 김철수| 3    |
| 김철수| 알고리즘 | 박교수 |
```

### 제3정규형 (3NF)

2NF + **이행적 함수 종속 제거** (A→B→C에서 A→C 간접 종속 분리).

```
❌ 3NF 위반:
| 학생 | 학과   | 학과장  |
|------|--------|--------|
| 김철수| 컴공   | 정교수 |
| 이영희| 전자   | 한교수 |

학생 → 학과 → 학과장 (이행적 종속)
학과장은 학과에 종속이지, 학생에 종속이 아님

✅ 3NF 충족: 테이블 분리
학생 테이블:              학과 테이블:
| 학생 | 학과 |          | 학과 | 학과장 |
|------|------|          |------|--------|
| 김철수| 컴공 |          | 컴공 | 정교수 |
| 이영희| 전자 |          | 전자 | 한교수 |
```

### BCNF (Boyce-Codd Normal Form)

3NF + **모든 결정자가 후보키**여야 함. 3NF의 강화 버전.

> 실무에서는 보통 3NF까지만 적용

---

## 정규형 요약

| 정규형 | 조건 | 핵심 |
|--------|------|------|
| 1NF | 원자값 | 한 칸에 하나의 값만 |
| 2NF | 1NF + 부분 종속 제거 | 복합키의 일부에 종속되는 컬럼 분리 |
| 3NF | 2NF + 이행 종속 제거 | A→B→C 간접 종속 분리 |
| BCNF | 모든 결정자가 후보키 | 3NF 강화 |

---

## 반정규화 (Denormalization)

### 왜 반정규화를 하나?

정규화하면 테이블이 많아짐 → **JOIN이 많아짐** → **조회 성능 저하**

```
정규화: 데이터 무결성 ↑, 중복 ↓, JOIN 비용 ↑
반정규화: 조회 성능 ↑, 중복 ↑, 무결성 관리 비용 ↑
```

### 반정규화 기법

| 기법 | 설명 | 예시 |
|------|------|------|
| 컬럼 중복 | 자주 조회하는 컬럼을 복사 | 주문 테이블에 상품명 저장 |
| 파생 컬럼 | 계산 결과를 미리 저장 | 게시글 테이블에 댓글 수(comment_count) |
| 테이블 합치기 | 1:1 관계 테이블 병합 | 유저 + 유저 프로필 |

### 실전 예시

```sql
-- 정규화된 상태: 매번 JOIN 필요
SELECT o.id, p.name, p.price
FROM orders o
JOIN products p ON o.product_id = p.id;

-- 반정규화: 주문 테이블에 상품명을 중복 저장
-- 조회 시 JOIN 불필요 → 빠름
SELECT id, product_name, product_price
FROM orders;

-- 단점: 상품명이 변경되면 orders도 업데이트해야 함
```

### 언제 반정규화하나?

```
반정규화 판단 기준:
├── 조회 빈도가 쓰기보다 압도적으로 높은가? → Yes면 고려
├── JOIN 비용이 서비스 성능에 영향을 주는가? → Yes면 고려
├── 데이터 정합성 관리가 가능한가? → Yes면 진행
└── 캐시로 해결할 수 있는가? → Yes면 캐시 먼저 (반정규화 전에)
```

---

## 면접 예상 질문

1. **정규화란?**
   - 데이터 중복 최소화, 이상 현상 방지를 위해 테이블을 분리하는 과정

2. **1NF, 2NF, 3NF를 설명해주세요**
   - 1NF: 원자값 / 2NF: 부분 종속 제거 / 3NF: 이행 종속 제거

3. **반정규화는 왜 하나요?**
   - 조회 성능 향상을 위해 의도적으로 중복을 허용

4. **정규화와 반정규화의 트레이드오프는?**
   - 정규화: 무결성 좋음, 조회 느림 / 반정규화: 조회 빠름, 정합성 관리 필요
