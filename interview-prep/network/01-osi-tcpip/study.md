# 1. OSI 7계층 / TCP/IP 4계층

---

## OSI 7계층이란?

네트워크 통신을 **7단계로 나눈 표준 모델**이다.
1984년 국제표준화기구(ISO)가 만들었다.

왜 나눴을까? 네트워크 통신은 복잡하다. 한 덩어리로 만들면:
- 문제가 생겼을 때 어디가 문제인지 찾기 어렵다
- 한 부분을 바꾸면 전체를 다 바꿔야 한다
- 여러 회사가 협력하기 어렵다

계층을 나누면:
- **각 계층이 자기 역할만 하면 된다** (단일 책임)
- 한 계층을 바꿔도 다른 계층에 영향이 없다
- 문제가 생기면 해당 계층만 확인하면 된다

> Spring Boot에서 Controller, Service, Repository를 나누는 이유와 같다.
> 역할을 분리하면 유지보수가 쉬워진다.

---

## 7계층 하나씩 알아보기

아래에서 위로 (1 → 7) 올라간다고 생각하면 된다.

### 1계층: 물리 계층 (Physical)

**역할**: 0과 1을 전기 신호, 빛, 전파로 바꿔서 실제로 전송한다.

```
컴퓨터 내부: 0 1 1 0 1 0 ...
    ↓ 변환
전선 위: ⚡ 전기 신호
와이파이: 📡 전파
광케이블: 💡 빛 신호
```

- 데이터의 내용은 모른다. 그냥 신호를 보내고 받을 뿐
- 장비: 케이블, 허브, 리피터

### 2계층: 데이터 링크 계층 (Data Link)

**역할**: **같은 네트워크 안에서** 장비 간 데이터를 전달한다.

```
같은 와이파이에 연결된 기기들:
[내 PC] ←→ [공유기] ←→ [다른 PC]
         2계층이 담당
```

- **MAC 주소**를 사용한다 (예: AA:BB:CC:DD:EE:FF)
- MAC 주소는 네트워크 장비의 고유 번호 (사람의 주민등록번호 같은 것)
- 데이터에 오류가 있는지 검사한다
- 장비: 스위치, 브릿지
- PDU 이름: **프레임(Frame)**

> **MAC 주소 vs IP 주소 차이**
> - MAC 주소: 장비에 고정된 물리적 주소 (변경 불가)
> - IP 주소: 네트워크에서 부여받는 논리적 주소 (변경 가능)

### 3계층: 네트워크 계층 (Network)

**역할**: **다른 네트워크까지** 데이터를 전달한다. 목적지까지 **길을 찾는다(라우팅)**.

```
[내 PC] → [우리집 공유기] → [KT 라우터] → [구글 라우터] → [구글 서버]
                      3계층이 경로를 결정
```

- **IP 주소**를 사용한다 (예: 192.168.0.1)
- 2계층은 같은 네트워크 안에서만 가능. 다른 네트워크로 가려면 3계층 필요
- 라우터가 "이 IP는 어디로 보내야 하지?" 결정한다 → **라우팅**
- 장비: 라우터
- PDU 이름: **패킷(Packet)**
- 프로토콜: **IP**, ICMP

> **비유**: 택배에서 "서울시 강남구 역삼동 123번지"라는 주소를 보고 길을 찾는 것

### 4계층: 전송 계층 (Transport)

**역할**: **프로세스 간** 데이터를 전달한다. 데이터가 제대로 도착하는지 **신뢰성을 보장**한다.

```
서버 IP: 192.168.0.10
    ├── 포트 8080: Spring Boot 서버
    ├── 포트 3306: MySQL
    └── 포트 6379: Redis

3계층(IP)은 서버 "컴퓨터"까지만 데이터를 보낸다.
4계층(TCP)은 그 중 "어느 프로그램"으로 보낼지 결정한다.
```

- **포트 번호**를 사용한다 (0~65535)
- IP 주소가 아파트 건물이라면, 포트 번호는 **호수(101호, 102호)**
- 프로토콜: **TCP** (신뢰성 보장), **UDP** (속도 우선)
- PDU 이름: **세그먼트(Segment)**

> **핵심 구분**
> - 3계층 IP: 컴퓨터까지 배달 (건물까지)
> - 4계층 TCP/UDP: 프로세스까지 배달 (호수까지)

### 5계층: 세션 계층 (Session)

**역할**: 통신의 **연결을 관리**한다. 연결을 시작하고, 유지하고, 끝낸다.

- 대화가 끊어졌을 때 어디서부터 다시 시작할지 관리
- 예: 대용량 파일 다운로드 중 끊겼을 때, 처음부터가 아니라 끊긴 지점부터 재개
- 실무에서 별도로 다루는 일이 적다 (면접에서 깊게 안 물어봄)

### 6계층: 표현 계층 (Presentation)

**역할**: 데이터의 **형식을 변환**한다.

```
변환 예시:
- 문자 인코딩: UTF-8 ↔ ASCII
- 데이터 압축: 원본 ↔ 압축
- 암호화: 평문 ↔ 암호문 (HTTPS의 TLS가 여기)
```

- 양쪽이 이해할 수 있는 형식으로 바꿔주는 번역기 역할
- 실무에서 별도로 다루는 일이 적다 (면접에서 깊게 안 물어봄)

### 7계층: 응용 계층 (Application)

**역할**: **사용자가 직접 쓰는 서비스**를 제공한다.

```
- 웹 브라우저로 사이트 접속: HTTP/HTTPS
- 이메일 보내기: SMTP
- 파일 전송: FTP
- 도메인으로 IP 찾기: DNS
```

- 우리가 만드는 Spring Boot REST API가 이 계층에서 동작한다
- 프로토콜: **HTTP**, HTTPS, DNS, FTP, SMTP

---

## 캡슐화와 역캡슐화

데이터를 보낼 때: 위에서 아래로 내려가며 **각 계층의 헤더가 붙는다** → 캡슐화

```
보내는 쪽 (캡슐화):

7계층: [데이터]
4계층: [TCP 헤더][데이터]              ← 세그먼트
3계층: [IP 헤더][TCP 헤더][데이터]      ← 패킷
2계층: [MAC 헤더][IP 헤더][TCP 헤더][데이터][꼬리] ← 프레임
1계층: 0101110010110... (전기 신호로 전송)
```

데이터를 받을 때: 아래에서 위로 올라가며 **헤더를 하나씩 벗긴다** → 역캡슐화

```
받는 쪽 (역캡슐화):

1계층: 전기 신호 수신
2계층: MAC 헤더 확인 후 제거 → "내 MAC 주소 맞네"
3계층: IP 헤더 확인 후 제거 → "내 IP 주소 맞네"
4계층: TCP 헤더 확인 후 제거 → "8080 포트니까 Spring Boot로"
7계층: Spring Boot가 [데이터] 수신!
```

**택배 비유**:
- 캡슐화 = 물건을 뽁뽁이로 싸고, 박스에 넣고, 송장을 붙이는 것
- 역캡슐화 = 송장 확인하고, 박스 열고, 뽁뽁이 벗기고, 물건 꺼내는 것

---

## TCP/IP 4계층

실제 인터넷은 OSI가 아니라 **TCP/IP 모델**로 동작한다.
OSI는 이론, TCP/IP는 실무라고 생각하면 된다.

```
OSI 7계층             TCP/IP 4계층              하는 일
─────────           ──────────              ──────
7 응용    ┐
6 표현    ├──→      4. 응용(Application)     HTTP, DNS 등 서비스
5 세션    ┘
4 전송    ──→       3. 전송(Transport)       TCP/UDP, 포트
3 네트워크 ──→      2. 인터넷(Internet)      IP, 라우팅
2 데이터링크 ┐
1 물리      ┘──→    1. 네트워크 접근          이더넷, 와이파이
                       (Network Access)
```

왜 OSI를 안 쓰고 TCP/IP를 쓸까?
- OSI는 너무 세분화되어 있다 (5,6계층이 실무에서 거의 구분 안 됨)
- TCP/IP는 실제 인터넷 프로토콜에 맞게 설계되었다
- 면접에서는 **둘 다 알아야** 한다

---

## Spring Boot 서버 관점

클라이언트가 `GET http://myapp.com:8080/api/users` 를 요청하면:

```
1. 클라이언트 (캡슐화)
   [7계층] 브라우저가 HTTP 요청 생성
   [4계층] TCP 연결 (목적지 포트 8080)
   [3계층] DNS로 myapp.com의 IP를 알아냄 → IP 헤더 추가
   [2계층] MAC 주소 추가
   [1계층] 전기 신호로 전송 →→→→→

2. 서버 (역캡슐화)
   [1계층] 전기 신호 수신
   [2계층] MAC 주소 확인 → 내 거 맞음
   [3계층] IP 주소 확인 → 내 거 맞음
   [4계층] 포트 8080 확인 → Spring Boot 프로세스로 전달
   [7계층] Spring Boot의 DispatcherServlet이 HTTP 요청을 받음
          → @GetMapping("/api/users") 매핑된 Controller 호출
```

---

## 면접 핵심 정리

**Q: OSI 7계층을 설명해주세요**
> 네트워크 통신을 7개 계층으로 나눈 모델입니다.
> 핵심 계층은 물리(신호 전송), 데이터링크(같은 네트워크 내 전송, MAC),
> 네트워크(다른 네트워크까지 전송, IP), 전송(프로세스까지 전송, TCP/UDP),
> 응용(HTTP 같은 서비스)입니다.

**Q: 왜 계층을 나누나요?**
> 각 계층이 독립적으로 동작하므로, 한 계층을 변경해도 다른 계층에 영향을 주지 않습니다.
> 문제 발생 시 해당 계층만 확인하면 되고, 유지보수가 쉬워집니다.

**Q: IP는 몇 계층? TCP는?**
> IP는 3계층(네트워크), TCP는 4계층(전송)입니다.
> IP는 목적지 컴퓨터까지, TCP는 그 컴퓨터의 특정 프로세스(포트)까지 데이터를 전달합니다.
